# 메서드 이동

###### Move Method

메서드가 자신이 속한 클래스보다 다른 클래스의 기능을 더 많이 이용할 땐 그 메서드가 제일 많이 이용하는 클래스 안에서 비슷한 내용의 새 메서드를 작성하자. 기존 메서드는 간단한 대리 메서드로 전환하거나 삭제하자

</br>

[클래스 다이어그램]
![Move Method.png](https://raw.githubusercontent.com/machine-human/Refactoring-Study/master/image/Move%20Method.PNG)

</br>

[방법]

1. 원본 클래스에 정의되어 있는 원본 메서드에 사용된 모든 기능을 검사해서 그 기능들도 전부 옮겨야 할지 판단
   
   (옮길 메서드에만 사용되는 기능도 그 메서드와 함께 옮겨야 함)
   
   (그 기능이 다른 메서드에서도 사용된다면 그 메서드를 함께 옮기는 것을 고려)
   
   (한 번에 하나씩 보다 한꺼번에 옮기는 것이 더 간편할 때도 있음)
   

</br>   

2. 원본 클래스의 하위 클래스와 상위클래스에서 그 메서드에 대한 다른 선언이 있는지 검사
   (있다면 대상 클래스에도 재정의를 넣을 수 있을 때만 옮길 수 있을지도 모른다)

</br>

3. 그 메서드를 대상 클래스 안에 선언
   (대상 클래스 안에 있을 때 더욱 어울리는 다른 이름으로 그 메서드를 정의해도 된다)

</br>

4. 원본 메서드의 코드를 대상 메서드에 복사 후 대상 클래스 안에서 잘 돌아가게끔 대상 메서드를 조금 수정
   (대상 메서드가 원본 메서드를 사용한다면 대상 메서드 안에서 원본 객체를 참조할 방법을 정해야 함)
   (대상 클래스에 원본 객체를 참조하는 기능이 없다면 원본 객체 참조를 대상 메서드에 매개변수로 전달)
   (대상 메서드에 예외처리 코드가 들어 있다면 예외를 논리적으로 어느 클래스가 처리할지 정하자)
   (원본 클래스에서 처리하기로 결정했다면 예외처리 코드는 내버려두자)

</br>

5. 대상 클래스 컴파일

</br>

6. 원본 객체에서 대상 객체를 참조할 방법을 정하자
   

</br>

7. 원본 메서드를 위임 메서드로 전환

</br>

8. 컴파일과 테스트를 실시

</br>

9. 원본 메서드를 삭제하거나 위임 메서드로 사용하게 둠

</br>

10. 원본 메서드를 삭제할 때는 기존의 참조를 전부 대상 메서드 참조로 수정

</br>

11. 컴파일과 테스트 실시

</br>

[예제]

- 수정 전

  ```java
  public class Account {
      private AccountType type;
      private int daysOverdrawn;
  
      private double overdraftChange() {
          if (type.isPremium()) {
              double result = 10;
              if (daysOverdrawn > 7) {
                  result += (daysOverdrawn - 7) * 0.85;
              }
              return result;
          } else {
              return daysOverdrawn * 1.75;
          }
      }
  
      private double bankCharge() {
          double result = 4.5;
          if (daysOverdrawn > 0) {
              result += overdraftChange();
          }
          return result;
      }
  }
  ```
  
  ```java
  public class AccountType {
      public boolean isPremium() {
          return false;
      }
  }
  ```

</br>

- 수정 후

  - Account 클래스의 overdraftChange() 메서드를 AccountType 클래스로 이동
  - 이동 한 메서드 내부에서 AccountType 객체 삭제
  - 원본 메서드의 코드를 위임 코드로 수정
  
  ```java
  public class Account {
      private AccountType type;
      private int daysOverdrawn;
  
      private double overdraftChange() {
          return type.overdraftChange(daysOverdrawn);
      }
  
      private double bankCharge() {
          double result = 4.5;
          if (daysOverdrawn > 0) {
              result += overdraftChange();
          }
        return result;
      }
  }
  ```
  
  ```java
  public class AccountType {
      public boolean isPremium() {
          return false;
      }
  
      public double overdraftChange(int daysOverdrawn) {
          if (isPremium()) {
              double result = 10;
              if (daysOverdrawn > 7) {
                  result += (daysOverdrawn - 7) * 0.85;
              }
              return result;
          } else {
              return daysOverdrawn * 1.75;
          }
      }
  }
  ```
  

</br>

[저자 왈]

- 위 예제는 원본 메서드는 필드를 하나만 참조하고 있으니, 그 필드를 변수로 전달해도 됨
- 그러나 그 메서드가 Acount 클래스의 다른 메서드를 호출한다면 원본 객체를 전달해야 함
- 또한 원본 클래스의 여러 기능이 필요할 때도 원본 객체를 전달